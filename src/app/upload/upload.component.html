<div class="bg-gradient-saintPetersburg jumbotron component-fill overflow-x-hidden">
    <div *ngIf="dto.file" class="m-3 d-none d-lg-flex col-lg-6 justify-content-center mw-100 mh-100">
        <ng-container *ngIf="previewImageUrl; else previewNotLoaded">
            <img class="img-fluid" [src]="previewImageUrl" style="object-fit: contain;" style="max-height: 70vh;"/>
        </ng-container>
        <ng-template #previewNotLoaded>
            <i class="fa fa-2x fa-spinner-third fa-spin" aria-hidden="true"></i>
        </ng-template>
    </div>
    <div class="my-0 my-md-4 col-12 col-md-6 col-lg-4">
        <h1 class="display-4 text-center"><i class="fas fa-rocket" aria-hidden="true"></i></h1>
        <h1 class="display-4 text-center mb-3">Image Uploading</h1>
        <ng-container *ngIf="isUploaded; else notUploaded">
            <div class="alert alert-success">
                <p *ngIf="uploadedInfo.title" class="font-weight-bold">{{uploadedInfo.title}}</p>
                <p class="m-0">Link: <a [href]="uploadedLink" target="_blank">{{uploadedLink}}</a> <summary class="fas fa-copy float-right" (click)="copyLink()"></summary></p>
                <p class="m-0" *ngIf="uploadedInfo.isPublic">Direct link: <a [href]="uploadedDirectLink" target="_blank">{{uploadedDirectLink}}</a> <summary class="fas fa-copy float-right" (click)="copyDirectLink()"></summary></p>
                <p class="mt-1 m-0" *ngIf="uploadedInfo.autoDeleteIn">Auto Delete: {{uploadedInfo.autoDeleteIn | date:'medium'}}</p>
            </div>
            <button type="button" class="btn btn-primary btn-block" (click)="reinit()">
                Upload more
            </button>
        </ng-container>
        <ng-template #notUploaded>
            <form name="uploadForm" #uploadForm="ngForm" (ngSubmit)="upload()">
                <div [hidden]="!currentUserService.currentUser" class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" [(ngModel)]="isAnonymous" name="isAnonymous" id="isAnonymous" (change)="onAnonymousCheckChanged()">
                    <label class="custom-control-label" for="isAnonymous">As Anonymous</label>
                    <small class="form-text text-muted">If you want upload an image without adding to own gallery</small>
                </div>
    
                <div class="custom-file mt-3">
                    <input [ngClass]="{ 'is-invalid': file.touched && file.invalid }" accept="image/*" type="file" class="custom-file-input" name="file" ngModel #file="ngModel" required (change)="onFileInputChanged($event)">
                    <label class="custom-file-label text-nowrap overflow-hidden" for="file">{{dto?.file?.name || "Choose file..."}}</label>
                    <div [hidden]="file.valid || file.untouched">
                        <p class="invalid-feedback d-block" *ngIf="file.errors?.required">You must select an image to upload.</p>
                        <p class="invalid-feedback d-block" *ngIf="file.errors?.invalidFiletype">Selected file type invalid.</p>
                        <p class="invalid-feedback d-block" *ngIf="file.errors?.sizeOverflow">File size must be &lt; 10MB.</p>
                        <p class="invalid-feedback d-block" *ngIf="file.errors?.invalidFile">Selected file is unsupported. Sorry.</p>
                    </div>
                </div>
                <div *ngIf="previewImageUrl" class="mt-3 d-flex d-lg-none justify-content-center mw-100" style="max-height: 70vh;">
                    <img class="img-fluid" [src]="previewImageUrl" style="object-fit: contain;"/>
                </div>
    
                <div class="form-group mt-3">
                    <input type="text" class="form-control" name="title" #title="ngModel" [(ngModel)]="dto.title" maxlength="64" placeholder="Title">
                </div>
                <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox" class="custom-control-input" [disabled]="isAnonymous" name="isPublic" #isPublic="ngModel" id="isPublic" [(ngModel)]="dto.isPublic">
                    <label class="custom-control-label" for="isPublic">Make public</label>
                    <small class="form-text text-muted">It's allow you to share this image simplify by link</small>
                </div>
                <div class="form-group">
                    <select [ngClass]="{ 'is-invalid': deleteInHours.touched && deleteInHours.invalid }" name="deleteInHours" #deleteInHours="ngModel" [(ngModel)]="dto.deleteInHours" (change)="onDeleteInHoursChanged()" class="custom-select" required>
                        <option value="0">Save for Forever</option>
                        <option value="1">Save for 1 Hour</option>
                        <option value="24">Save for 24 Hours</option>
                        <option value="168">Save for Week</option>
                        <option value="720">Save for Month</option>
                    </select>
                    <div [hidden]="deleteInHours.valid || deleteInHours.untouched">
                        <p class="invalid-feedback d-block" *ngIf="deleteInHours.errors?.lifetimeForbidden">Anonymous upload doesn't allow you select lifetime shelter</p>
                    </div>
                </div>
    
                <div class="form-group">
                    <select [ngClass]="{ 'is-invalid': quality.touched && quality.invalid }" name="quality" #quality="ngModel" [(ngModel)]="dto.quality" (change)="onQualityChanged()" class="custom-select" required>
                        <option value="95">Good Quality</option>
                        <option value="70">Medium Quality</option>
                        <option value="100">Original Quality</option>
                    </select>
                    <small *ngIf="dto.quality == 95" class="form-text text-muted">Best choice to share and save any non-transperent image</small>
                    <small *ngIf="dto.quality == 70" class="form-text text-muted">Well compressed image to embedding anywhere</small>
                    <small *ngIf="dto.quality == 100" class="form-text text-muted">Excellent quality without any changes!</small>
                    <div [hidden]="quality.valid || quality.untouched">
                        <p class="invalid-feedback d-block" *ngIf="quality.errors?.qualityForbidden">This quality disallowed for anonymous upload</p>
                    </div>
                </div>
    
                <ngb-progressbar *ngIf="isUploading" class="mb-2" type="primary" [value]="progress" [animated]="true" [striped]="true"></ngb-progressbar>
    
                <button type="submit" [disabled]="uploadForm.invalid || isUploading" class="btn btn-primary btn-block">
                    <ng-container *ngIf="isUploading; else notUploading">
                        Claiming a new shelter
                    </ng-container>
                    <ng-template #notUploading>
                        Receive the shelter
                    </ng-template>
                </button>
            </form>
        </ng-template>
    </div>
</div>